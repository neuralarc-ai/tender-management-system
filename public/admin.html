<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Arc Inc - Admin Portal</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #1e3a8a;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-badge {
            background: #dbeafe;
            color: #1e40af;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            height: fit-content;
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .sidebar h2 {
            color: #111827;
            font-size: 18px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tender-item {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tender-item:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .tender-item.active {
            border-color: #3b82f6;
            background: #dbeafe;
        }

        .tender-item-title {
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .tender-item-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #6b7280;
        }

        .main-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #6b7280;
        }

        .empty-state i {
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .tender-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tender-title {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
        }

        .tender-meta {
            display: flex;
            gap: 20px;
            color: #6b7280;
            font-size: 14px;
        }

        .countdown {
            background: #fef3c7;
            color: #92400e;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .countdown.urgent {
            background: #fee2e2;
            color: #991b1b;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-content {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            color: #374151;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .ai-analysis-container {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .analysis-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3a8a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-status {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-analyzing {
            background: #dbeafe;
            color: #1e40af;
            animation: pulse 2s infinite;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .analyzing-message {
            text-align: center;
            padding: 40px;
            color: #1e40af;
        }

        .spinner {
            border: 3px solid #dbeafe;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .score-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .score-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 36px;
            font-weight: 700;
            color: #1e3a8a;
        }

        .score-value.high {
            color: #059669;
        }

        .score-value.medium {
            color: #d97706;
        }

        .score-value.low {
            color: #dc2626;
        }

        .delivery-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .delivery-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .delivery-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .delivery-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .delivery-fill {
            height: 100%;
            transition: width 0.5s;
        }

        .delivery-fill.can {
            background: #10b981;
        }

        .delivery-fill.partial {
            background: #f59e0b;
        }

        .delivery-fill.out {
            background: #ef4444;
        }

        .delivery-percentage {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .insight-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .insight-title {
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .insight-list {
            list-style: none;
        }

        .insight-list li {
            padding: 8px 0;
            color: #6b7280;
            font-size: 13px;
            line-height: 1.5;
            border-bottom: 1px solid #f3f4f6;
        }

        .insight-list li:last-child {
            border-bottom: none;
        }

        .proposal-editor {
            margin-top: 30px;
        }

        .editor-section {
            margin-bottom: 24px;
        }

        .editor-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            display: block;
        }

        .editor-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            min-height: 150px;
            resize: vertical;
            transition: all 0.3s;
        }

        .editor-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .action-bar {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: start;
            gap: 12px;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <i data-lucide="brain"></i>
                Neural Arc Inc - Admin Portal
            </h1>
            <div class="header-badge">
                <i data-lucide="shield-check"></i>
                Tender Applicant
            </div>
        </div>

        <div class="content">
            <div class="sidebar">
                <h2>
                    <i data-lucide="inbox"></i>
                    Available Tenders
                </h2>
                <div id="tenderList"></div>
            </div>

            <div class="main-content">
                <div id="tenderDetail"></div>
            </div>
        </div>
    </div>

    <script>
        let tenders = [];
        let selectedTenderId = null;

        // Initialize
        async function init() {
            await loadTenders();
            setInterval(loadTenders, 2000); // Poll every 2 seconds
            lucide.createIcons();
        }

        // Load tenders
        async function loadTenders() {
            try {
                const response = await fetch('/api/tenders');
                const newTenders = await response.json();
                
                // Check if selected tender was updated
                if (selectedTenderId) {
                    const oldTender = tenders.find(t => t.id === selectedTenderId);
                    const newTender = newTenders.find(t => t.id === selectedTenderId);
                    
                    if (oldTender && newTender && JSON.stringify(oldTender) !== JSON.stringify(newTender)) {
                        tenders = newTenders;
                        renderTenderList();
                        renderTenderDetail(selectedTenderId);
                    } else {
                        tenders = newTenders;
                        renderTenderList();
                    }
                } else {
                    tenders = newTenders;
                    renderTenderList();
                    
                    // Auto-select first tender
                    if (tenders.length > 0 && !selectedTenderId) {
                        selectTender(tenders[0].id);
                    }
                }
                
                lucide.createIcons();
            } catch (error) {
                console.error('Error loading tenders:', error);
            }
        }

        // Render tender list
        function renderTenderList() {
            const container = document.getElementById('tenderList');
            
            if (tenders.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #6b7280;">
                        <i data-lucide="inbox" style="width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.5;"></i>
                        <p>No tenders available</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = tenders.map(tender => `
                <div class="tender-item ${selectedTenderId === tender.id ? 'active' : ''}" onclick="selectTender('${tender.id}')">
                    <div class="tender-item-title">${tender.title}</div>
                    <div class="tender-item-meta">
                        <span><i data-lucide="calendar" style="width: 12px; height: 12px;"></i> ${new Date(tender.createdAt).toLocaleDateString()}</span>
                        <span><i data-lucide="clock" style="width: 12px; height: 12px;"></i> ${getTimeRemaining(tender.submissionDeadline)}</span>
                    </div>
                </div>
            `).join('');
        }

        // Select tender
        function selectTender(tenderId) {
            selectedTenderId = tenderId;
            renderTenderList();
            renderTenderDetail(tenderId);
            lucide.createIcons();
        }

        // Render tender detail
        function renderTenderDetail(tenderId) {
            const tender = tenders.find(t => t.id === tenderId);
            if (!tender) return;

            const container = document.getElementById('tenderDetail');
            
            container.innerHTML = `
                <div class="tender-detail-header">
                    <div>
                        <div class="tender-title">${tender.title}</div>
                        <div class="tender-meta">
                            <span><i data-lucide="calendar"></i> Submitted: ${new Date(tender.createdAt).toLocaleDateString()}</span>
                            <span><i data-lucide="user"></i> Client: TCS/DCS</span>
                        </div>
                    </div>
                    <div>
                        ${getCountdown(tender.submissionDeadline)}
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchTab(event, 'overview')">
                        <i data-lucide="file-text"></i>
                        Overview
                    </button>
                    <button class="tab" onclick="switchTab(event, 'analysis')">
                        <i data-lucide="brain"></i>
                        AI Analysis
                    </button>
                    <button class="tab" onclick="switchTab(event, 'proposal')">
                        <i data-lucide="edit"></i>
                        Proposal Draft
                    </button>
                </div>

                <div id="overview-tab" class="tab-content active">
                    ${renderOverviewTab(tender)}
                </div>

                <div id="analysis-tab" class="tab-content">
                    ${renderAnalysisTab(tender)}
                </div>

                <div id="proposal-tab" class="tab-content">
                    ${renderProposalTab(tender)}
                </div>
            `;
        }

        // Render overview tab
        function renderOverviewTab(tender) {
            return `
                <div class="section">
                    <div class="section-title">
                        <i data-lucide="file-text"></i>
                        Description
                    </div>
                    <div class="section-content">${tender.description}</div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <i data-lucide="target"></i>
                        Scope of Work
                    </div>
                    <div class="section-content">${tender.scopeOfWork}</div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <i data-lucide="cpu"></i>
                        Technical Requirements
                    </div>
                    <div class="section-content">${tender.technicalRequirements}</div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <i data-lucide="settings"></i>
                        Functional Requirements
                    </div>
                    <div class="section-content">${tender.functionalRequirements}</div>
                </div>

                <div class="section">
                    <div class="section-title">
                        <i data-lucide="shield-check"></i>
                        Eligibility Criteria
                    </div>
                    <div class="section-content">${tender.eligibilityCriteria}</div>
                </div>

                ${tender.documents && tender.documents.length > 0 ? `
                    <div class="section">
                        <div class="section-title">
                            <i data-lucide="paperclip"></i>
                            Supporting Documents
                        </div>
                        <div class="section-content">
                            ${tender.documents.map(doc => `
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <i data-lucide="file"></i>
                                    <a href="${doc.url}" target="_blank" style="color: #3b82f6; text-decoration: none;">${doc.name}</a>
                                    <span style="color: #9ca3af; font-size: 12px;">(${(doc.size / 1024).toFixed(1)} KB)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // Render analysis tab
        function renderAnalysisTab(tender) {
            const analysis = tender.aiAnalysis;

            if (analysis.status === 'pending') {
                return `
                    <div class="ai-analysis-container">
                        <div class="analysis-header">
                            <div class="analysis-title">
                                <i data-lucide="brain"></i>
                                AI Analysis
                            </div>
                            <span class="analysis-status status-pending">Pending</span>
                        </div>
                        <div class="analyzing-message">
                            <i data-lucide="clock" style="width: 48px; height: 48px; margin-bottom: 12px;"></i>
                            <p style="font-weight: 600; margin-bottom: 8px;">Analysis will begin shortly</p>
                            <p style="font-size: 14px;">The system will automatically analyze this tender against Neural Arc's capabilities.</p>
                        </div>
                    </div>
                `;
            }

            if (analysis.status === 'analyzing') {
                return `
                    <div class="ai-analysis-container">
                        <div class="analysis-header">
                            <div class="analysis-title">
                                <i data-lucide="brain"></i>
                                AI Analysis
                            </div>
                            <span class="analysis-status status-analyzing">Analyzing</span>
                        </div>
                        <div class="analyzing-message">
                            <div class="spinner"></div>
                            <p style="font-weight: 600; margin-bottom: 8px;">Please wait 5â€“10 minutes</p>
                            <p style="font-size: 14px;">The system is analyzing and knitting the tender documents...</p>
                        </div>
                    </div>
                `;
            }

            // Completed analysis
            return `
                <div class="ai-analysis-container">
                    <div class="analysis-header">
                        <div class="analysis-title">
                            <i data-lucide="brain"></i>
                            AI Analysis Results
                        </div>
                        <span class="analysis-status status-completed">Completed</span>
                    </div>

                    <div class="score-grid">
                        <div class="score-card">
                            <div class="score-label">Relevance Score</div>
                            <div class="score-value ${getScoreClass(analysis.relevanceScore)}">${analysis.relevanceScore}%</div>
                        </div>
                        <div class="score-card">
                            <div class="score-label">Feasibility Score</div>
                            <div class="score-value ${getScoreClass(analysis.feasibilityScore)}">${analysis.feasibilityScore}%</div>
                        </div>
                        <div class="score-card">
                            <div class="score-label">Overall Score</div>
                            <div class="score-value ${getScoreClass(analysis.overallScore)}">${analysis.overallScore}%</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 24px;">
                        <h3 style="font-size: 16px; font-weight: 600; color: #111827; margin-bottom: 16px;">
                            <i data-lucide="pie-chart"></i>
                            Delivery Capability Breakdown
                        </h3>
                        <div class="delivery-breakdown">
                            <div class="delivery-card">
                                <div class="delivery-label" style="color: #059669;">
                                    <i data-lucide="check-circle"></i>
                                    Fully Deliverable
                                </div>
                                <div class="delivery-bar">
                                    <div class="delivery-fill can" style="width: ${analysis.canDeliver}%"></div>
                                </div>
                                <div class="delivery-percentage">${analysis.canDeliver}%</div>
                            </div>
                            <div class="delivery-card">
                                <div class="delivery-label" style="color: #d97706;">
                                    <i data-lucide="alert-circle"></i>
                                    Partially Deliverable
                                </div>
                                <div class="delivery-bar">
                                    <div class="delivery-fill partial" style="width: ${analysis.partialDeliver}%"></div>
                                </div>
                                <div class="delivery-percentage">${analysis.partialDeliver}%</div>
                            </div>
                            <div class="delivery-card">
                                <div class="delivery-label" style="color: #dc2626;">
                                    <i data-lucide="x-circle"></i>
                                    Out of Scope
                                </div>
                                <div class="delivery-bar">
                                    <div class="delivery-fill out" style="width: ${analysis.outOfScope}%"></div>
                                </div>
                                <div class="delivery-percentage">${analysis.outOfScope}%</div>
                            </div>
                        </div>
                    </div>

                    <div class="insights-grid">
                        <div class="insight-card">
                            <div class="insight-title" style="color: #dc2626;">
                                <i data-lucide="alert-triangle"></i>
                                Identified Gaps
                            </div>
                            <ul class="insight-list">
                                ${analysis.gaps.map(gap => `<li>${gap}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="insight-card">
                            <div class="insight-title" style="color: #d97706;">
                                <i data-lucide="shield-alert"></i>
                                Potential Risks
                            </div>
                            <ul class="insight-list">
                                ${analysis.risks.map(risk => `<li>${risk}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="insight-card">
                            <div class="insight-title" style="color: #3b82f6;">
                                <i data-lucide="info"></i>
                                Key Assumptions
                            </div>
                            <ul class="insight-list">
                                ${analysis.assumptions.map(assumption => `<li>${assumption}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div style="margin-top: 20px; padding: 16px; background: white; border-radius: 8px; font-size: 13px; color: #6b7280;">
                        <i data-lucide="clock"></i>
                        Analysis completed at ${new Date(analysis.completedAt).toLocaleString()}
                    </div>
                </div>
            `;
        }

        // Render proposal tab
        function renderProposalTab(tender) {
            const proposal = tender.proposal;
            const analysis = tender.aiAnalysis;

            if (analysis.status !== 'completed') {
                return `
                    <div class="alert alert-info">
                        <i data-lucide="info"></i>
                        <div>
                            <strong>Proposal draft will be generated automatically</strong>
                            <p style="margin-top: 4px; font-size: 14px;">Once the AI analysis is complete, a draft proposal will be generated for your review and editing.</p>
                        </div>
                    </div>
                `;
            }

            if (proposal.status === 'submitted') {
                return `
                    <div class="alert alert-success">
                        <i data-lucide="check-circle"></i>
                        <div>
                            <strong>Proposal Submitted Successfully</strong>
                            <p style="margin-top: 4px; font-size: 14px;">Your proposal was submitted on ${new Date(proposal.submittedAt).toLocaleString()} and is now under review by the client.</p>
                        </div>
                    </div>
                    ${renderProposalPreview(proposal)}
                `;
            }

            return `
                <div class="alert alert-warning">
                    <i data-lucide="edit"></i>
                    <div>
                        <strong>Draft Proposal Generated</strong>
                        <p style="margin-top: 4px; font-size: 14px;">Review and edit the AI-generated proposal below. Add commercial details and submit when ready.</p>
                    </div>
                </div>

                <div class="proposal-editor">
                    <div class="editor-section">
                        <label class="editor-label">Executive Summary</label>
                        <textarea class="editor-textarea" id="executiveSummary">${proposal.executiveSummary}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Understanding of Requirements</label>
                        <textarea class="editor-textarea" id="requirementsUnderstanding">${proposal.requirementsUnderstanding}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Technical Approach</label>
                        <textarea class="editor-textarea" id="technicalApproach">${proposal.technicalApproach}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Scope Coverage</label>
                        <textarea class="editor-textarea" id="scopeCoverage">${proposal.scopeCoverage}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Exclusions</label>
                        <textarea class="editor-textarea" id="exclusions">${proposal.exclusions}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Assumptions</label>
                        <textarea class="editor-textarea" id="assumptions">${proposal.assumptions}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Delivery Timeline</label>
                        <textarea class="editor-textarea" id="timeline">${proposal.timeline}</textarea>
                    </div>

                    <div class="editor-section">
                        <label class="editor-label">Commercial Details (Pricing, Payment Terms, etc.)</label>
                        <textarea class="editor-textarea" id="commercialDetails" placeholder="Add pricing, payment terms, and other commercial details...">${proposal.commercialDetails}</textarea>
                    </div>

                    <div class="action-bar">
                        <button class="btn btn-secondary" onclick="saveProposalDraft()">
                            <i data-lucide="save"></i>
                            Save Draft
                        </button>
                        <button class="btn btn-success" onclick="submitProposal()">
                            <i data-lucide="send"></i>
                            Submit Proposal to Client
                        </button>
                    </div>
                </div>
            `;
        }

        // Render proposal preview
        function renderProposalPreview(proposal) {
            return `
                <div style="margin-top: 20px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 20px;">Submitted Proposal</h3>
                    
                    <div class="section">
                        <div class="section-title">Executive Summary</div>
                        <div class="section-content">${proposal.executiveSummary}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Understanding of Requirements</div>
                        <div class="section-content">${proposal.requirementsUnderstanding}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Technical Approach</div>
                        <div class="section-content">${proposal.technicalApproach}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Scope Coverage</div>
                        <div class="section-content">${proposal.scopeCoverage}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Exclusions</div>
                        <div class="section-content">${proposal.exclusions}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Assumptions</div>
                        <div class="section-content">${proposal.assumptions}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Delivery Timeline</div>
                        <div class="section-content">${proposal.timeline}</div>
                    </div>

                    ${proposal.commercialDetails ? `
                        <div class="section">
                            <div class="section-title">Commercial Details</div>
                            <div class="section-content">${proposal.commercialDetails}</div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Helper functions
        function getTimeRemaining(deadline) {
            const now = new Date();
            const end = new Date(deadline);
            const diff = end - now;

            if (diff < 0) return 'Expired';

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

            if (days > 0) return `${days}d ${hours}h`;
            return `${hours}h`;
        }

        function getCountdown(deadline) {
            const now = new Date();
            const end = new Date(deadline);
            const diff = end - now;

            if (diff < 0) {
                return '<span class="countdown expired"><i data-lucide="clock"></i>Expired</span>';
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

            const isUrgent = days < 2;
            const className = isUrgent ? 'countdown urgent' : 'countdown';

            if (days > 0) {
                return `<span class="${className}"><i data-lucide="clock"></i>${days}d ${hours}h remaining</span>`;
            } else if (hours > 0) {
                return `<span class="${className}"><i data-lucide="clock"></i>${hours}h ${minutes}m remaining</span>`;
            } else {
                return `<span class="${className}"><i data-lucide="clock"></i>${minutes}m remaining</span>`;
            }
        }

        function getScoreClass(score) {
            if (score >= 80) return 'high';
            if (score >= 60) return 'medium';
            return 'low';
        }

        function switchTab(event, tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            lucide.createIcons();
        }

        // Save proposal draft
        async function saveProposalDraft() {
            const proposalData = {
                executiveSummary: document.getElementById('executiveSummary').value,
                requirementsUnderstanding: document.getElementById('requirementsUnderstanding').value,
                technicalApproach: document.getElementById('technicalApproach').value,
                scopeCoverage: document.getElementById('scopeCoverage').value,
                exclusions: document.getElementById('exclusions').value,
                assumptions: document.getElementById('assumptions').value,
                timeline: document.getElementById('timeline').value,
                commercialDetails: document.getElementById('commercialDetails').value
            };

            try {
                const response = await fetch(`/api/tenders/${selectedTenderId}/proposal`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(proposalData)
                });

                if (response.ok) {
                    alert('Proposal draft saved successfully!');
                    await loadTenders();
                }
            } catch (error) {
                alert('Error saving proposal: ' + error.message);
            }
        }

        // Submit proposal
        async function submitProposal() {
            if (!confirm('Are you sure you want to submit this proposal to the client? This action cannot be undone.')) {
                return;
            }

            // First save the draft
            await saveProposalDraft();

            // Then submit
            try {
                const response = await fetch(`/api/tenders/${selectedTenderId}/proposal/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    alert('Proposal submitted successfully! The client will be notified.');
                    await loadTenders();
                }
            } catch (error) {
                alert('Error submitting proposal: ' + error.message);
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>